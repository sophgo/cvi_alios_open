## PIN

### 概要

该文档主要描述PIN模块的CSI2.0自动化测试AT命令。 文档中所涉及的这些命令是用来测试PIN模块的接口工作是否正常、数据传输是否正确、接口返回值是否符合预期。

### 测试原理

测试时，应给被测试板发送PIN测试命令进行相应的测试；测试程序会按照按照测试命令的配置进行相应的测试， 若结果与预期一致，则相应的测试成功完成，否则测试失败。

### 测试流程

- 测试前应当准备好测试板（以下简称A板）
- 发送PIN测试命令进行测试 （测试命令功能请参照下文）

### PIN功能AT命令列表概览

以下是PIN模块对应的测试命令列表及其功能简要介绍。

| AT命令列表         | 功能                                                         |
| ------------------ | ------------------------------------------------------------ |
| AT+PIN_INTERFACE   | PIN接口异常测试                                              |
| AT+PIN_CONFIG      | 测试硬件PIN脚的复用，以及管脚的默认输入输出、传输速率等功能  |
| AT+PIN_GET_DEVIDX  | 测试设置硬件PIN脚后，通过pin name获取GPIO端口号、UART设备号、IIC设备号、SPI设备号、I2S设备号 |
| AT+PIN_GET_CHANNEL | 测试设置硬件PIN脚后，通过pin name获取GPIO通道号、PWM通道、ADC通道 |
| AT+PIN_GET_PINNAME | 测试设置硬件PIN脚后，通过PIN端口号与通道号获取pin name       |

### 参数列表

以下是PIN模块对应的AT测试命令共用参数的简要介绍。

| 参数名字 | 释义                     | 取值范围                                                     |
| -------- | ------------------------ | ------------------------------------------------------------ |
| pin_name | 表示管脚号               | 0、1、...，具体可测编号需参考soc.h                           |
| func     | 表示管脚复用功能编号     | 0、1、...，具体可测编号需参考soc.h                           |
| mode     | 表示PIN使用那种模式      | 0:GPIO_MODE_PULLNONE<br/>1:GPIO_MODE_PULLUP<br/>2:GPIO_MODE_PULLDOWN<br/>3:GPIO_MODE_OPEN_DRAIN<br/>4:GPIO_MODE_PUSH_PULL |
| speed    | 表示PIN的速度等级        | 0:PIN_SPEED_LV0,0级(0级为最低速)<br/>1:PIN_SPEED_LV1,1级<br/>2:PIN_SPEED_LV2,2级<br/>3:PIN_SPEED_LV3,3级 |
| drive    | 表示PIN的驱动能力        | 0:PIN_DRIVE_LV0,0级(0级驱动能力最弱)<br/>1:PIN_DRIVE_LV1,1级<br/>2:PIN_DRIVE_LV2,2级<br/>3:PIN_DRIVE_LV3,3级 |
| type     | 表示驱动类型             | 0:GPIO<br/>1:UART<br/>2:IIC<br/>3:SPI<br/>4:I2S<br/>5:PWM<br/>6:ADC |
| idx      | 表示设备号,比如0表示i2s0 | 0、1、...，具体可测编号需参考soc.h                           |

### 命令详解

#### AT+PIN_INTERFACE

| 命令格式 | AT+PIN_INTERFACE                                             |
| -------- | ------------------------------------------------------------ |
| 命令功能 | PIN接口异常测试。该命令测试PIN所CSI接口的异常调用，测试时将会传入异常和非法参数，验证CSI接口是否返回相应的错误码。 |
| 示例     | 发送命令AT+PIN_INTERFACE到A板，测试完成后，A板对应串口会打印OK；否则测试失败 |

#### AT+PIN_CONFIG

| 命令格式 | AT+PIN_CONFIG=pin_name,func,mode,speed,drive |
|------------------------------------------|--------------------------------------------------------------------------------------------------|
| 命令功能 | 测试硬件PIN脚的复用，以及管脚的默认输入输出、传输速率等功能 |
| 示例 | 步骤1:发送测试命令到测试板：<br/>AT+PIN_CONFIG=0,0,0,0,0 <br/>测试完成后， 板子对应串口会打印OK；否则测试失败 |


#### AT+PIN_GET_DEVIDX

| 命令格式 | AT+PIN_GET_DEVIDX=pin_name,type,expect_idx                   |
|------------------------------------------|--------------------------------------------------------------------------------------------------|
| 命令功能 | 测试通过pin name获取GPIO端口号、UART设备号、IIC设备号、SPI设备号、I2S设备号 |
| 示例     | 步骤1:发送测试命令到测试板：<br/>AT+PIN_GET_DEVIDX=0,0,0 <br/>测试完成后， 板子对应串口会打印OK；否则测试失败 |
#### AT+PIN_GET_CHANNEL

| 命令格式 | AT+PIN_GET_CHANNEL=pin_name,type,expect_channel              |
| -------- | ------------------------------------------------------------ |
| 命令功能 | 测试通过pin name获取GPIO通道号、PWM通道、ADC通道             |
| 示例     | 步骤1:发送测试命令到测试板：<br/>AT+PIN_GET_CHANNEL=0,0,0 <br/>测试完成后， 板子对应串口会打印OK；否则测试失败 |

#### AT+PIN_GET_PINNAME

| 命令格式 | AT+PIN_GET_PINNAME=idx,gpio_channel,expect_pinname           |
| -------- | ------------------------------------------------------------ |
| 命令功能 | 测试通过PIN端口号与通道号获取pin name                        |
| 示例     | 步骤1:发送测试命令到测试板：<br/>AT+PIN_GET_PINNAME=0,0,0 <br/>测试完成后， 板子对应串口会打印OK；否则测试失败 |